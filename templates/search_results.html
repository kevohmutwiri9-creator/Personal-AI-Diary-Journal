{% extends "base.html" %}

{% block title %}Search Results - My Diary{% endblock %}

{% block content %}
<div class="search-page">
    <h1><i class="fas fa-search"></i> Search Your Diary</h1>
    
    <div class="search-form">
        <form method="GET" action="{{ url_for('search') }}">
            <div class="search-inputs">
                <div class="form-group">
                    <label for="query" class="form-label">Search Text</label>
                    <input 
                        type="text" 
                        id="query" 
                        name="query" 
                        class="form-input" 
                        placeholder="Enter keywords to search..."
                        value="{{ query }}"
                    >
                </div>
                
                <div class="date-filters">
                    <div class="form-group">
                        <label for="date_from" class="form-label">From Date</label>
                        <input 
                            type="date" 
                            id="date_from" 
                            name="date_from" 
                            class="form-input"
                            value="{{ date_from }}"
                        >
                    </div>
                    
                    <div class="form-group">
                        <label for="date_to" class="form-label">To Date</label>
                        <input 
                            type="date" 
                            id="date_to" 
                            name="date_to" 
                            class="form-input"
                            value="{{ date_to }}"
                        >
                    </div>
                </div>
            </div>
            
            <div class="search-actions">
                <button type="submit" class="btn">
                    <i class="fas fa-search"></i> Search
                </button>
                <a href="{{ url_for('search') }}" class="btn btn-secondary">
                    <i class="fas fa-refresh"></i> Clear
                </a>
            </div>
        </form>
    </div>
    
    {% if query or date_from or date_to %}
        <div class="search-results">
            <h2>
                <i class="fas fa-list"></i> Search Results
                {% if results %}
                    ({{ results|length }} found)
                {% endif %}
            </h2>
            
            {% if results %}
                <div class="results-list">
                    {% for entry in results %}
                        <div class="result-item">
                            <div class="result-header">
                                <span class="result-date">
                                    <i class="fas fa-calendar"></i>
                                    {{ entry.timestamp.strftime('%B %d, %Y at %I:%M %p') if entry.timestamp else 'No date' }}
                                </span>
                                <div class="result-actions">
                                    <a href="{{ url_for('view_entry', entry_id=entry.id) }}" class="btn btn-small">
                                        <i class="fas fa-eye"></i> View
                                    </a>
                                    <a href="{{ url_for('edit_entry', entry_id=entry.id) }}" class="btn btn-small">
                                        <i class="fas fa-edit"></i> Edit
                                    </a>
                                </div>
                            </div>
                            <div class="result-content">
                                {% if query %}
                                    {% set highlighted_content = entry.content|replace(query, '<mark>' + query + '</mark>') %}
                                    {{ highlighted_content|replace('\n', '<br>')|safe }}
                                {% else %}
                                    {{ entry.content[:200] }}{% if entry.content|length > 200 %}...{% endif %}
                                {% endif %}
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="no-results">
                    <i class="fas fa-search"></i>
                    <h3>No entries found</h3>
                    <p>Try adjusting your search criteria or date range.</p>
                </div>
            {% endif %}
        </div>
    {% endif %}
    
    <div class="back-to-dashboard">
        <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Back to Dashboard
        </a>
    </div>
</div>

<style>
    .search-page {
        max-width: 1000px;
        margin: 0 auto;
    }

    .search-page h1 {
        text-align: center;
        margin-bottom: 30px;
        color: #333;
    }

    .dark-mode .search-page h1 {
        color: #ecf0f1;
    }

    .search-form {
        background: rgba(255, 255, 255, 0.5);
        border-radius: 15px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }

    .dark-mode .search-form {
        background: rgba(44, 62, 80, 0.5);
    }

    .search-inputs {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 20px;
        margin-bottom: 20px;
    }

    .date-filters {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
    }

    .search-actions {
        display: flex;
        gap: 15px;
        justify-content: center;
    }

    .search-results h2 {
        margin-bottom: 20px;
        color: #333;
    }

    .dark-mode .search-results h2 {
        color: #ecf0f1;
    }

    .results-list {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }

    .result-item {
        background: rgba(255, 255, 255, 0.7);
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease;
    }

    .result-item:hover {
        transform: translateY(-2px);
    }

    .dark-mode .result-item {
        background: rgba(44, 62, 80, 0.7);
    }

    .result-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 1px solid #e0e0e0;
    }

    .dark-mode .result-header {
        border-bottom-color: #34495e;
    }

    .result-date {
        color: #666;
        font-weight: 500;
    }

    .dark-mode .result-date {
        color: #bdc3c7;
    }

    .result-actions {
        display: flex;
        gap: 10px;
    }

    .result-content {
        line-height: 1.6;
        color: #333;
    }

    .dark-mode .result-content {
        color: #ecf0f1;
    }

    .result-content mark {
        background: #ffeb3b;
        padding: 2px 4px;
        border-radius: 3px;
    }

    .dark-mode .result-content mark {
        background: #f39c12;
        color: #2c3e50;
    }

    .no-results {
        text-align: center;
        padding: 60px 20px;
        color: #666;
    }

    .dark-mode .no-results {
        color: #bdc3c7;
    }

    .no-results i {
        font-size: 4rem;
        margin-bottom: 20px;
        color: #ccc;
    }

    .no-results h3 {
        margin-bottom: 10px;
        color: #333;
    }

    .dark-mode .no-results h3 {
        color: #ecf0f1;
    }

    .back-to-dashboard {
        text-align: center;
        margin-top: 30px;
    }

    @media (max-width: 768px) {
        .search-inputs {
            grid-template-columns: 1fr;
        }

        .date-filters {
            grid-template-columns: 1fr;
        }

        .result-header {
            flex-direction: column;
            gap: 15px;
            align-items: flex-start;
        }

        .result-actions {
            width: 100%;
            justify-content: center;
        }
    }
</style>
{% endblock %}
