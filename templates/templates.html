{% extends "base.html" %}

{% block title %}Entry Templates - My Diary{% endblock %}

{% block content %}
<div class="templates-page">
    <h1><i class="fas fa-file-alt"></i> Entry Templates</h1>
    <p class="page-subtitle">Create and manage reusable templates for your diary entries</p>

    <div class="create-template">
        <h2><i class="fas fa-plus"></i> Create New Template</h2>
        <form method="POST" action="{{ url_for('create_template') }}" class="template-form">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>

            <div class="form-row">
                <div class="form-group">
                    <label for="template_name" class="form-label">Template Name</label>
                    <input
                        type="text"
                        id="template_name"
                        name="name"
                        class="form-input"
                        placeholder="e.g., Daily Reflection, Gratitude Journal"
                        required
                    >
                </div>

                <div class="form-group">
                    <label for="template_category" class="form-label">Category (Optional)</label>
                    <select id="template_category" name="category_id" class="form-input">
                        <option value="">Select a category...</option>
                        {% for category in categories %}
                            <option value="{{ category.id }}" style="color: {{ category.color }};">
                                {{ category.name }}
                            </option>
                        {% endfor %}
                    </select>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="template_content" class="form-label">Template Content</label>
                    <textarea
                        id="template_content"
                        name="content"
                        class="form-input form-textarea"
                        placeholder="Write your template content here. Use placeholders like [DATE], [MOOD], [LOCATION] that will be replaced when using the template."
                        required
                        rows="8"
                    ></textarea>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="template_mood" class="form-label">Default Mood (Optional)</label>
                    <select id="template_mood" name="mood" class="form-input">
                        <option value="">No default mood</option>
                        <option value="üòä Happy">üòä Happy</option>
                        <option value="üò¢ Sad">üò¢ Sad</option>
                        <option value="üò¥ Tired">üò¥ Tired</option>
                        <option value="ü§î Thoughtful">ü§î Thoughtful</option>
                        <option value="üò§ Frustrated">üò§ Frustrated</option>
                        <option value="üòå Peaceful">üòå Peaceful</option>
                        <option value="üéâ Excited">üéâ Excited</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="template_weather" class="form-label">Default Weather (Optional)</label>
                    <select id="template_weather" name="weather" class="form-input">
                        <option value="">No default weather</option>
                        <option value="‚òÄÔ∏è Sunny">‚òÄÔ∏è Sunny</option>
                        <option value="‚õÖ Partly Cloudy">‚õÖ Partly Cloudy</option>
                        <option value="‚òÅÔ∏è Cloudy">‚òÅÔ∏è Cloudy</option>
                        <option value="üåßÔ∏è Rainy">üåßÔ∏è Rainy</option>
                        <option value="‚õàÔ∏è Stormy">‚õàÔ∏è Stormy</option>
                        <option value="‚ùÑÔ∏è Snowy">‚ùÑÔ∏è Snowy</option>
                    </select>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="template_location" class="form-label">Default Location (Optional)</label>
                    <input
                        type="text"
                        id="template_location"
                        name="location"
                        class="form-input"
                        placeholder="e.g., Home, Office, Park"
                    >
                </div>

                <div class="form-group">
                    <label for="template_tags" class="form-label">Default Tags (Optional)</label>
                    <input
                        type="text"
                        id="template_tags"
                        name="tags"
                        class="form-input"
                        placeholder="e.g., reflection, daily, personal"
                    >
                </div>
            </div>

            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" name="is_default">
                    <span class="checkmark"></span>
                    Set as default template (will appear first in list)
                </label>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn">
                    <i class="fas fa-save"></i> Create Template
                </button>
                <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">
                    <i class="fas fa-arrow-left"></i> Back to Dashboard
                </a>
            </div>
        </form>
    </div>

    {% if templates %}
        <div class="templates-list">
            <h2><i class="fas fa-list"></i> Your Templates</h2>

            <div class="templates-grid">
                {% for template in templates %}
                    <div class="template-card">
                        <div class="template-header">
                            <h3>{{ template.name }}</h3>
                            {% if template.is_default %}
                                <span class="default-badge">Default</span>
                            {% endif %}
                        </div>

                        <div class="template-meta">
                            <small>
                                {% if template.category %}
                                    <span style="color: {{ template.category.color }};">{{ template.category.name }}</span>
                                {% endif %}
                                {% if template.mood %} ‚Ä¢ {{ template.mood }}{% endif %}
                                {% if template.weather %} ‚Ä¢ {{ template.weather }}{% endif %}
                            </small>
                        </div>

                        <div class="template-preview">
                            {{ template.content[:100] }}{% if template.content|length > 100 %}...{% endif %}
                        </div>

                        <div class="template-actions">
                            <a href="{{ url_for('use_template', template_id=template.id) }}" class="btn btn-small">
                                <i class="fas fa-edit"></i> Use Template
                            </a>
                            <form method="POST" action="{{ url_for('delete_template', template_id=template.id) }}" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this template?')">
                                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                                <button type="submit" class="btn btn-small btn-danger">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                            </form>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    {% else %}
        <div class="no-templates">
            <i class="fas fa-file-alt"></i>
            <h3>No templates yet</h3>
            <p>Create your first template above to get started!</p>
        </div>
    {% endif %}
</div>

<style>
    .templates-page {
        max-width: 1200px;
        margin: 0 auto;
    }

    .create-template {
        background: rgba(255, 255, 255, 0.7);
        border-radius: 15px;
        padding: 30px;
        margin-bottom: 40px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }

    .dark-mode .create-template {
        background: rgba(44, 62, 80, 0.7);
    }

    .template-form .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 20px;
    }

    .templates-list h2 {
        margin-bottom: 30px;
        color: #333;
        text-align: center;
    }

    .dark-mode .templates-list h2 {
        color: #ecf0f1;
    }

    .templates-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 25px;
    }

    .template-card {
        background: rgba(255, 255, 255, 0.7);
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease;
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .template-card:hover {
        transform: translateY(-2px);
    }

    .dark-mode .template-card {
        background: rgba(44, 62, 80, 0.7);
        border-color: rgba(52, 152, 219, 0.2);
    }

    .template-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
    }

    .template-header h3 {
        color: #333;
        margin: 0;
    }

    .dark-mode .template-header h3 {
        color: #ecf0f1;
    }

    .default-badge {
        background: #f39c12;
        color: white;
        padding: 2px 8px;
        border-radius: 10px;
        font-size: 0.8rem;
        font-weight: 500;
    }

    .template-meta {
        margin-bottom: 15px;
    }

    .template-preview {
        line-height: 1.6;
        color: #666;
        margin-bottom: 20px;
        min-height: 60px;
    }

    .dark-mode .template-preview {
        color: #bdc3c7;
    }

    .template-actions {
        display: flex;
        gap: 10px;
        justify-content: center;
    }

    .no-templates {
        text-align: center;
        padding: 80px 20px;
        color: #666;
    }

    .dark-mode .no-templates {
        color: #bdc3c7;
    }

    .no-templates i {
        font-size: 4rem;
        margin-bottom: 20px;
        color: #ccc;
    }

    .no-templates h3 {
        margin-bottom: 15px;
        color: #333;
    }

    .dark-mode .no-templates h3 {
        color: #ecf0f1;
    }

    @media (max-width: 768px) {
        .template-form .form-row {
            grid-template-columns: 1fr;
        }

        .templates-grid {
            grid-template-columns: 1fr;
        }

        .template-header {
            flex-direction: column;
            gap: 10px;
            align-items: flex-start;
        }
    }
</style>
{% endblock %}
