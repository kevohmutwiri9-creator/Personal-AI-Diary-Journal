{% extends "base.html" %}

{% block title %}Backup & Restore - My Diary{% endblock %}

{% block content %}
<div class="backup-page">
    <h1><i class="fas fa-database"></i> Backup & Restore</h1>
    <p class="page-subtitle">Safeguard your diary data with backup and restore functionality</p>

    <!-- Create Backup Section -->
    <div class="backup-section">
        <h2><i class="fas fa-download"></i> Create Backup</h2>
        <p class="section-desc">Download a complete backup of all your diary data including entries, categories, and templates.</p>

        <form method="POST" class="backup-form">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            <input type="hidden" name="action" value="create_backup"/>

            <div class="backup-info">
                <div class="info-item">
                    <i class="fas fa-info-circle"></i>
                    <div>
                        <strong>What's included:</strong>
                        <ul>
                            <li>All diary entries with metadata</li>
                            <li>Categories and color settings</li>
                            <li>Entry templates</li>
                            <li>Timestamps and creation dates</li>
                        </ul>
                    </div>
                </div>

                <div class="info-item">
                    <i class="fas fa-shield-alt"></i>
                    <div>
                        <strong>Security:</strong>
                        <p>Your backup file contains only your data. Passwords and sensitive information are not included.</p>
                    </div>
                </div>
            </div>

            <button type="submit" class="btn">
                <i class="fas fa-download"></i> Create & Download Backup
            </button>
        </form>
    </div>

    <!-- Restore Backup Section -->
    <div class="restore-section">
        <h2><i class="fas fa-upload"></i> Restore from Backup</h2>
        <p class="section-desc">Upload a previously created backup file to restore your diary data.</p>

        <form method="POST" enctype="multipart/form-data" class="restore-form">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            <input type="hidden" name="action" value="restore_backup"/>

            <div class="form-group">
                <label for="backup_file" class="form-label">Select Backup File</label>
                <input
                    type="file"
                    id="backup_file"
                    name="backup_file"
                    class="form-input"
                    accept=".json"
                    required
                >
                <small class="form-help">Only JSON backup files are supported</small>
            </div>

            <div class="restore-info">
                <div class="info-item warning">
                    <i class="fas fa-exclamation-triangle"></i>
                    <div>
                        <strong>Important:</strong>
                        <ul>
                            <li>Existing entries with the same ID will be skipped</li>
                            <li>Categories with the same name will not be duplicated</li>
                            <li>Templates with the same ID will be skipped</li>
                            <li>This operation cannot be undone</li>
                        </ul>
                    </div>
                </div>
            </div>

            <button type="submit" class="btn btn-danger" onclick="return confirm('Are you sure you want to restore from this backup? This will add new data to your existing diary.')">
                <i class="fas fa-upload"></i> Restore from Backup
            </button>
        </form>
    </div>

    <!-- Backup Tips -->
    <div class="tips-section">
        <h2><i class="fas fa-lightbulb"></i> Backup Tips</h2>
        <div class="tips-grid">
            <div class="tip-item">
                <i class="fas fa-calendar-check"></i>
                <div>
                    <h4>Regular Backups</h4>
                    <p>Create backups regularly to ensure you never lose your data.</p>
                </div>
            </div>

            <div class="tip-item">
                <i class="fas fa-lock"></i>
                <div>
                    <h4>Secure Storage</h4>
                    <p>Store backup files in a safe location like encrypted cloud storage.</p>
                </div>
            </div>

            <div class="tip-item">
                <i class="fas fa-mobile-alt"></i>
                <div>
                    <h4>Multiple Devices</h4>
                    <p>Use backups to sync your diary across different devices.</p>
                </div>
            </div>
        </div>
    </div>

    <div class="backup-actions">
        <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Back to Dashboard
        </a>
    </div>
</div>

<style>
    .backup-page {
        max-width: 800px;
        margin: 0 auto;
    }

    .backup-section, .restore-section {
        background: rgba(255, 255, 255, 0.7);
        border-radius: 15px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }

    .dark-mode .backup-section, .dark-mode .restore-section {
        background: rgba(44, 62, 80, 0.7);
    }

    .section-desc {
        color: #666;
        margin-bottom: 20px;
        font-size: 1.1rem;
    }

    .dark-mode .section-desc {
        color: #bdc3c7;
    }

    .backup-info, .restore-info {
        margin-bottom: 25px;
    }

    .info-item {
        display: flex;
        align-items: flex-start;
        gap: 15px;
        padding: 15px;
        background: rgba(102, 126, 234, 0.1);
        border-radius: 10px;
        margin-bottom: 15px;
    }

    .info-item.warning {
        background: rgba(231, 76, 60, 0.1);
        border-left: 4px solid #e74c3c;
    }

    .dark-mode .info-item {
        background: rgba(52, 152, 219, 0.1);
    }

    .dark-mode .info-item.warning {
        background: rgba(231, 76, 60, 0.1);
    }

    .info-item i {
        color: #667eea;
        font-size: 1.2rem;
        margin-top: 2px;
        min-width: 20px;
    }

    .info-item.warning i {
        color: #e74c3c;
    }

    .info-item ul {
        margin: 5px 0;
        padding-left: 20px;
    }

    .info-item li {
        margin-bottom: 3px;
        color: #333;
    }

    .dark-mode .info-item li {
        color: #ecf0f1;
    }

    .backup-form, .restore-form {
        text-align: center;
    }

    .tips-section {
        background: rgba(255, 255, 255, 0.5);
        border-radius: 15px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }

    .dark-mode .tips-section {
        background: rgba(44, 62, 80, 0.5);
    }

    .tips-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-top: 20px;
    }

    .tip-item {
        display: flex;
        align-items: flex-start;
        gap: 15px;
        padding: 20px;
        background: rgba(255, 255, 255, 0.3);
        border-radius: 10px;
    }

    .dark-mode .tip-item {
        background: rgba(255, 255, 255, 0.1);
    }

    .tip-item i {
        color: #667eea;
        font-size: 1.5rem;
        margin-top: 2px;
        min-width: 25px;
    }

    .tip-item h4 {
        margin-bottom: 5px;
        color: #333;
    }

    .dark-mode .tip-item h4 {
        color: #ecf0f1;
    }

    .tip-item p {
        color: #666;
        font-size: 0.9rem;
        line-height: 1.4;
    }

    .dark-mode .tip-item p {
        color: #bdc3c7;
    }

    .backup-actions {
        text-align: center;
    }

    @media (max-width: 768px) {
        .tips-grid {
            grid-template-columns: 1fr;
        }

        .info-item {
            flex-direction: column;
            gap: 10px;
        }
    }
</style>
{% endblock %}
